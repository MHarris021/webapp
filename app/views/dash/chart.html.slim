h2 CoinThink Bitcoin/USD Arbitrage Strategy Report

- if @strategy
  div#strategy
    ' Strategy ##{@strategy.id}
    time datetime="#{@strategy.created_at.iso8601}" data-format="yyyy-MMM-dd HH:mm"

  div
    | Total Opportunity

  div
    div
      - trade_stage = @strategy.stage.children.select{|s| s.name=="Trades"}.first
      ' Including market fees
      span style="font-size: 110%; font-weight:bold"
        ' #{trade_stage.balance_in} in => #{trade_stage.balance_out}
      | (profit $#{trade_stage.potential} #{"%0.3f"%trade_stage.profit_percentage}%)
    div
      ' Including transfer fees
      span style="font-size: 110%; font-weight:bold; color:#{@strategy.potential < 0 ? "#e00" : "black"}"
        ' #{@strategy.balance_in} in => #{@strategy.balance_out} out
      | (profit $#{@strategy.potential} #{"%0.3f"%@strategy.profit_percentage}%)

  div style="margin: 1em 0em"
    | Optimal Trade Amounts
    div
      table style="float:left"
        - @strategy.exchange_balances.select{|eb| eb.balances.select{|b|b.usd? && b>0}.any?}.each do |eb|
          tr
            td #{eb.exchange.name}
            - eb.balances.each do |b|
              td
                | #{b if b>0}
      div style="float:left"
        i
          | ---- to ---->
      table style="float:left"
        - @strategy.exchange_balances.select{|eb| eb.balances.select{|b|b.btc? && b>0}.any?}.each do |eb|
          tr
            td #{eb.exchange.name}
            - eb.balances.each do |b|
              td
                | #{b if b>0}
div.clearboth

div Strategy History

div#chart

div#legend

div.clearboth

div Exchanges
ul
  table
    - Exchange.all.each do |exchange|
      - if exchange.markets.internal.size > 0
        tr
          td
            | #{exchange.name} #{image_tag "/flags/#{exchange.country_code}.png"}
            - unless exchange.active
              | (disabled)
          td
            |  #{exchange.markets.internal[0,1].map{|market| "#{market.from_currency}/#{market.to_currency} fee #{market.fee_percentage}%"}.join(' ')}
          td
            - etime=exchange.exchange_runs.last
            - if etime && exchange.active
              time datetime="#{etime.start_at.iso8601}" data-format="ddd HH:mm"
              | :#{"%0.3f"%(etime.start_at.sec+(etime.start_at.nsec/1000000000.0))} #{"%0.3f"%(etime.duration_ms/1000)}s

- if @strategy
  div
    div Strategy Details
    - @strategy.stage.children.each do |stage|
      div Stage "#{stage.name}": #{stage.balance_in} in => #{stage.balance_out} out. profit $#{stage.potential} #{"%0.3f"%stage.profit_percentage}%
      ul
        - stage.trades.each do |t|
            li class="#{t.balance_in.btc? ? "bid" : ""}"
              | #{t.offer.market.name} #{t.balance_in.btc? ? "sell" : "buy"} #{t.balance_in}@$#{"%0.3f"%t.offer.price} fee #{"%0.1f%"%t.expected_fee} out #{t.calculated_out}
        - stage.children.each do |stage|
          - stage.trades.each do |t|
            li class="#{t.balance_in.btc? ? "bid" : ""}"
              | #{t.offer.market.name} #{t.balance_in.btc? ? "sell" : "buy"} #{t.balance_in}@$#{"%0.3f"%t.offer.price} fee #{"%0.1f%"%t.expected_fee} out #{t.calculated_out} #{"(profit #{"%0.3f"%stage.profit(t).amount})" if t.balance_in.btc?}


javascript:
  $(function() {
    setup(#{{JSON.pretty_generate(@chart_data)}},
          #{{@strategy_percentages.to_json}},
          #{{@strategy_data.to_json}},
          #{{@strategy_ids.to_json}})

    // fixup the timestamps with the browser's timezone
    $('time').each(function(){
      var datetime = new XDate($(this).attr('datetime'))
      var formatted = datetime.toString($(this).attr('data-format'))
      $(this).html(formatted)
    })
    var timezone_name = (new XDate()).toString().slice(-4,-1) //hack to get the full timezone name
    $('#working_timezone').html(timezone_name)
  })

div.footer
  p.disclaimer
    ' Times are displayed in
    span#working_timezone
    br
    | All information is provided on a best-effort basis with NO WARRANTY. Data may be incorrect, invalid, or out of date.

